<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vingle Tech Talk 6th!</title>
  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,minimum-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" type="text/css">
</head>
<body>
<div class="container">
  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a href="#" class="navbar-item is-active">Videos</a>
    </div>
  </nav>

  <h2>Welcome to Vingle Tech Talk 6th!</h2>

  <p>
    <button type="button" class="button" onclick="changeVideo()">Change Video</button>
  </p>
  <div class="card">
    <div class="card-image">
      <video controls id="video" onplaying="onPlaying()" onpause="onPause()"></video>
    </div>
  </div>
</div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
<script type="text/javascript">
  ((root) => {
    const VIDEO_URLS = [
      'https://i.imgur.com/IY678sD.mp4',
      'https://i.imgur.com/2swrmoj.mp4',
      'https://i.imgur.com/2o6l8gv.mp4',
      'https://i.imgur.com/JhSSQH1.mp4',
    ];

    // 총 시청시간, 평균 시청 지속 시간
    let startedAt = 0;

    root.changeVideo = () => {
      root.video.pause();

      // Give some time to trigger pause event
      setTimeout(() => {
        root.video.src = _.sample(VIDEO_URLS);
        root.video.load();
      }, 10);
    };

    root.onPlaying = () => {
      startedAt = root.video.currentTime;
    };

    root.onPause = () => {
      const videoId = root.video.src;
      const endedAt = root.video.currentTime;
      recordEvent(videoId, startedAt, endedAt);
      startedAt = 0;
    };

    root.recordEvent = (videoId, start, end) => {
      const duration = end - start;
      console.log('played %s during %.2f seconds (%.2f ~ %.2f)', videoId, duration, start, end);
    };
  })(window);
</script>
</body>
</html>